#!/usr/bin/env bash
set -euo pipefail

repo_root="$(git rev-parse --show-toplevel)"
cd "${repo_root}"

echo "[pre-commit] Validating worktree guard..."
bash scripts/guard-worktree.sh

if [[ "${PII_SKIP_QUALITY:-0}" == "1" ]]; then
  echo "[pre-commit] Quality checks skipped by PII_SKIP_QUALITY=1"
  exit 0
fi

echo "[pre-commit] Running lint..."
npm run lint

echo "[pre-commit] Running type-check..."
npx tsc --noEmit --pretty false

echo "[pre-commit] Running tests..."
npm run test:run

echo "[pre-commit] Running build..."
npm run build

echo "[pre-commit] OK"
