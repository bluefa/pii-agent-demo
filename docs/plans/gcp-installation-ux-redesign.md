# GCP 설치 상태 UX 리디자인

> 2026-02-08 작성

## 1. 현재 문제점

### 현재 UI 출력 예시

```
bigquery://asia-northeast3/search-log-86753/sales_data
BigQuery
Service TF       TF 설치 대기
BDC TF           TF 설치 대기
```

### 문제 분석

| # | 문제 | 심각도 | 설명 |
|---|------|--------|------|
| 1 | **"TF" 용어 노출** | Critical | Terraform의 약어로, 개발팀 내부 용어. 사용자는 의미를 알 수 없음 |
| 2 | **Service TF / BDC TF 이중 표시** | Critical | 백엔드 내부 아키텍처(2단계 TF)가 그대로 노출. 사용자에게 불필요한 정보 |
| 3 | **"TF 설치 대기" 라벨** | High | 무엇이 설치되는 건지, 대기라면 언제 진행되는 건지 맥락 없음 |
| 4 | **리소스별 상세 노출** | Medium | 리소스 URI(`bigquery://...`) + 연결 유형 + TF 상태 2줄 = 정보 과부하 |
| 5 | **Regional Managed Proxy Subnet** | Medium | GCP 인프라 용어 그대로 노출. "Subnet 자동 생성" 버튼의 의미 불명확 |

### 현재 파일 구조

```
app/components/features/process-status/gcp/
├── GcpInstallationInline.tsx      # 메인 (297줄)
├── RegionalManagedProxyPanel.tsx   # Private IP 서브넷 관리 (107줄)
└── PscApprovalGuide.tsx            # PSC 승인 가이드 (100줄)

lib/constants/gcp.ts                # TF 상태 라벨, 연결 유형 라벨
lib/types/gcp.ts                    # GcpInstallResource, GcpTfStatus 등
```

### 현재 데이터 모델 (참고)

```typescript
interface GcpInstallResource {
  id: string;
  name: string;                           // "bigquery://asia-northeast3/..."
  resourceType: 'CLOUD_SQL' | 'BIGQUERY';
  connectionType: 'PRIVATE_IP' | 'PSC' | 'BIGQUERY';
  serviceTfStatus: GcpTfStatus;           // PENDING | IN_PROGRESS | COMPLETED | FAILED
  bdcTfStatus: GcpTfStatus;
  regionalManagedProxy?: GcpRegionalManagedProxyStatus;
  pscConnection?: GcpPscConnectionStatus;
  isCompleted: boolean;
}
```

---

## 2. 설계 원칙

1. **내부 용어 은닉** — TF, Service TF, BDC TF, Subnet, PSC 등 인프라 용어를 사용자 친화적 표현으로 변환
2. **상태 단순화** — `serviceTfStatus` + `bdcTfStatus` → 단일 통합 상태로 매핑
3. **조치 중심** — 사용자가 해야 할 일이 있으면 명확히, 없으면 "자동 진행 중"으로 안심
4. **점진적 공개** — 요약부터 보여주고, 필요 시 상세를 펼쳐볼 수 있도록

### 통합 상태 매핑

| serviceTf | bdcTf | → 통합 상태 | 사용자 라벨 |
|-----------|-------|------------|------------|
| COMPLETED | COMPLETED | `COMPLETED` | 설치 완료 |
| FAILED | any | `FAILED` | 설치 실패 |
| any | FAILED | `FAILED` | 설치 실패 |
| IN_PROGRESS | any | `IN_PROGRESS` | 설치 진행 중 |
| any | IN_PROGRESS | `IN_PROGRESS` | 설치 진행 중 |
| PENDING | PENDING | `PENDING` | 설치 준비 중 |
| COMPLETED | PENDING | `IN_PROGRESS` | 설치 진행 중 |

### 사용자 조치가 필요한 경우

| 케이스 | 조건 | 사용자에게 보여줄 내용 |
|--------|------|---------------------|
| Private IP — 서브넷 미생성 | `regionalManagedProxy.exists === false` | "네트워크 설정이 필요합니다" + 자동 설정 버튼 |
| PSC — 승인 대기 | `pscConnection.status === 'PENDING_APPROVAL'` | "연결 승인이 필요합니다" + 승인 가이드 |
| PSC — 거부됨 | `pscConnection.status === 'REJECTED'` | "연결이 거부되었습니다. 재신청이 필요합니다" |
| TF 실패 | `serviceTfStatus === 'FAILED' \|\| bdcTfStatus === 'FAILED'` | "설치 중 오류가 발생했습니다. 관리자에게 문의하세요" |

---

## 3. UX 대안

### 대안 A: 단순 상태 뱃지

리소스별 한 줄 표시. TF 이중 상태를 통합 상태 뱃지 하나로 대체.

```
┌─────────────────────────────────────────────────────┐
│ GCP 에이전트 설치 현황                    2/5 완료 🔄│
├─────────────────────────────────────────────────────┤
│                                                     │
│  Cloud SQL ─ db-instance-01         ● 설치 완료     │
│  Cloud SQL ─ db-instance-02         ◐ 설치 진행 중  │
│  Cloud SQL ─ db-analytics           ⚠ 조치 필요     │
│  BigQuery ─ search-log              ○ 설치 준비 중  │
│  BigQuery ─ sales_data              ○ 설치 준비 중  │
│                                                     │
│  ⚠ db-analytics: 네트워크 설정이 필요합니다         │
│     [네트워크 자동 설정]  가이드 보기 →              │
│                                                     │
└─────────────────────────────────────────────────────┘
```

**특징**
- 리소스명: URI 대신 인스턴스명만 표시 (예: `db-instance-01`)
- 연결 유형(Private IP/PSC/BigQuery)은 숨기고, 리소스 타입(Cloud SQL/BigQuery)만 표시
- Service TF + BDC TF → 하나의 통합 상태 뱃지
- 조치 필요 항목은 하단에 액션 카드로 분리

**장점**: 정보 밀도 유지, 관리자도 개별 리소스 파악 가능
**단점**: 리소스가 많으면 여전히 긴 목록

---

### 대안 B: 요약 카드 + 조치만 노출

전체 진행률을 프로그레스 바로 표시하고, 사용자 조치가 필요한 항목만 카드로 노출.

```
┌─────────────────────────────────────────────────────┐
│ GCP 에이전트 설치 현황                            🔄│
├─────────────────────────────────────────────────────┤
│                                                     │
│  ████████████░░░░░░░░░░░░░░  2/5 리소스 설치 완료   │
│                                                     │
│  ┌─ ⚠ 조치 필요 ─────────────────────────────────┐ │
│  │                                                │ │
│  │  db-analytics — 네트워크 설정이 필요합니다     │ │
│  │  [네트워크 자동 설정]                          │ │
│  │                                                │ │
│  └────────────────────────────────────────────────┘ │
│                                                     │
│  나머지 2건은 자동으로 설치가 진행됩니다.           │
│                                                     │
└─────────────────────────────────────────────────────┘
```

**특징**
- 프로그레스 바 + 완료 카운트로 전체 현황 요약
- 사용자 조치 필요 항목만 눈에 띄게 카드로 노출
- 자동 진행 중인 항목은 "나머지 N건은 자동으로 설치가 진행됩니다"로 안심 문구
- 개별 리소스 목록 숨김

**장점**: 사용자 관점에서 가장 직관적. "내가 뭘 해야 하지?"에 즉답
**단점**: 관리자가 개별 리소스 상태를 볼 수 없음

---

### 대안 C: 2단 구조 (요약 + 접기/펼치기)

B의 요약 카드를 기본으로, 하단에 펼치면 A의 리소스 목록을 볼 수 있는 구조.

```
┌─────────────────────────────────────────────────────┐
│ GCP 에이전트 설치 현황                            🔄│
├─────────────────────────────────────────────────────┤
│                                                     │
│  ████████████░░░░░░░░░░░░░░  2/5 리소스 설치 완료   │
│                                                     │
│  ┌─ ⚠ 조치 필요 ─────────────────────────────────┐ │
│  │                                                │ │
│  │  db-analytics — 네트워크 설정이 필요합니다     │ │
│  │  [네트워크 자동 설정]                          │ │
│  │                                                │ │
│  └────────────────────────────────────────────────┘ │
│                                                     │
│  나머지 2건은 자동으로 설치가 진행됩니다.           │
│                                                     │
│  ▸ 전체 리소스 상태 보기                            │
│  ┌──────────────────────────────────────────────┐   │
│  │ Cloud SQL ─ db-instance-01      ● 설치 완료  │   │
│  │ Cloud SQL ─ db-instance-02      ◐ 설치 진행중│   │
│  │ Cloud SQL ─ db-analytics        ⚠ 조치 필요  │   │
│  │ BigQuery ─ search-log           ○ 설치 준비중│   │
│  │ BigQuery ─ sales_data           ○ 설치 준비중│   │
│  └──────────────────────────────────────────────┘   │
│                                                     │
└─────────────────────────────────────────────────────┘
```

**특징**
- 기본 뷰: B와 동일 (요약 + 조치 카드)
- "전체 리소스 상태 보기" 토글로 A의 상세 목록 펼침
- 접힌 상태가 기본 → 일반 사용자는 요약만, 관리자는 펼쳐서 확인

**장점**: 일반 사용자와 관리자 모두 만족. 정보량 조절 가능
**단점**: 구현 복잡도 약간 증가

---

### 대안 D: 최소 UI (액션 온리)

평상시에는 한 줄 진행률만 표시. 사용자 조치가 필요할 때만 카드가 나타남.

```
── 조치 필요 없을 때 ──

┌─────────────────────────────────────────────────────┐
│  ◐ GCP 에이전트 설치 중... (2/5 완료)            🔄│
└─────────────────────────────────────────────────────┘

── 조치 필요할 때 ──

┌─────────────────────────────────────────────────────┐
│  ◐ GCP 에이전트 설치 중... (2/5 완료)            🔄│
├─────────────────────────────────────────────────────┤
│  ⚠ db-analytics — 네트워크 설정이 필요합니다       │
│    [네트워크 자동 설정]  가이드 보기 →              │
└─────────────────────────────────────────────────────┘

── 완료 시 ──

┌─────────────────────────────────────────────────────┐
│  ● GCP 에이전트 설치 완료 (5/5)                     │
└─────────────────────────────────────────────────────┘
```

**특징**
- 진행 중: 한 줄 진행률
- 조치 필요: 한 줄 진행률 + 액션 카드
- 완료: 한 줄 완료 표시
- 리소스 목록 일체 없음

**장점**: 가장 깔끔. 사용자 혼란 최소
**단점**: 관리자가 상세를 볼 수 없음. 디버깅 시 불편

---

### 대안 E: 하이브리드 — 단계별 그룹핑 + 조치 카드 (채택)

D의 간결함을 유지하면서, 설치 과정을 **단계별 그룹**으로 나눠 진행 상황을 파악할 수 있는 구조.
리소스를 개별 나열하지 않고, **"무엇이 진행되고 있는가"** 를 단계 단위로 요약한다.

#### 핵심 아이디어

GCP 설치 과정은 내부적으로 3가지 축으로 나뉜다:

| 내부 모델 | → 사용자에게 보이는 그룹 | 설명 |
|-----------|------------------------|------|
| `serviceTfStatus` | **서비스 환경 구성** | 고객 GCP 프로젝트에 네트워크/IAM 등 리소스 생성 |
| `bdcTfStatus` | **BDC 연동 설정** | BDC 측에서 에이전트 연결을 위한 설정 수행 |
| `regionalManagedProxy` / `pscConnection` | **조치 필요** | 사용자가 직접 수행해야 하는 항목 |

이 그룹핑은 리소스를 일일이 나열하지 않으면서도, 서비스 담당자가 "지금 어느 단계가 진행 중인지" 파악할 수 있게 한다.

#### 그룹별 상태 집계 로직

```typescript
// 서비스 환경 구성 — serviceTfStatus 기준
const serviceCompleted = resources.filter(r => r.serviceTfStatus === 'COMPLETED').length;
const serviceFailed = resources.filter(r => r.serviceTfStatus === 'FAILED').length;
const serviceTotal = resources.length;

// BDC 연동 설정 — bdcTfStatus 기준
const bdcCompleted = resources.filter(r => r.bdcTfStatus === 'COMPLETED').length;
const bdcFailed = resources.filter(r => r.bdcTfStatus === 'FAILED').length;
const bdcTotal = resources.length;

// 조치 필요 — 사용자 액션이 필요한 리소스
const actionNeeded = resources.filter(r =>
  (r.regionalManagedProxy?.exists === false) ||
  (r.pscConnection?.status === 'PENDING_APPROVAL' || r.pscConnection?.status === 'REJECTED')
);
```

#### 그룹 상태 표시 규칙

| 조건 | 상태 표시 | 아이콘 | 색상 |
|------|----------|--------|------|
| 전체 COMPLETED | `완료 (n/n)` | ● | `statusColors.success` |
| FAILED 있음 | `일부 실패 (완료 n/n, 실패 m건)` | ✕ | `statusColors.error` |
| IN_PROGRESS 있음 | `진행 중 (n/n)` | ◐ | `statusColors.warning` |
| 전체 PENDING | `준비 중 (0/n)` | ○ | `statusColors.pending` |
| COMPLETED + PENDING 혼재 | `진행 중 (n/n)` | ◐ | `statusColors.warning` |

#### 와이어프레임 — 전체 상태별

**── 1. 초기 상태 (모두 PENDING) ──**

```
┌─────────────────────────────────────────────────────┐
│  ◐ GCP 에이전트 설치 중... (0/5 완료)            🔄│
│  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  0%       │
│                                                     │
│  서비스 환경 구성          ○ 준비 중 (0/5)          │
│  BDC 연동 설정            ○ 준비 중 (0/5)          │
│                                                     │
│  자동으로 설치가 진행 중입니다.                      │
└─────────────────────────────────────────────────────┘
```

**── 2. 서비스 환경 구성 진행 중 ──**

```
┌─────────────────────────────────────────────────────┐
│  ◐ GCP 에이전트 설치 중... (0/5 완료)            🔄│
│  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  0%       │
│                                                     │
│  서비스 환경 구성          ◐ 진행 중 (2/5)          │
│  BDC 연동 설정            ○ 준비 중 (0/5)          │
│                                                     │
│  자동으로 설치가 진행 중입니다.                      │
└─────────────────────────────────────────────────────┘
```

**── 3. 서비스 완료, BDC 진행 중 ──**

```
┌─────────────────────────────────────────────────────┐
│  ◐ GCP 에이전트 설치 중... (2/5 완료)            🔄│
│  ████████████████░░░░░░░░░░░░░░░░░░░░░░  40%       │
│                                                     │
│  서비스 환경 구성          ● 완료 (5/5)             │
│  BDC 연동 설정            ◐ 진행 중 (2/5)          │
│                                                     │
│  자동으로 설치가 진행 중입니다.                      │
└─────────────────────────────────────────────────────┘
```

**── 4. 조치 필요 (네트워크 설정) ──**

```
┌─────────────────────────────────────────────────────┐
│  ◐ GCP 에이전트 설치 중... (1/5 완료)            🔄│
│  ████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  20%       │
│                                                     │
│  서비스 환경 구성          ◐ 진행 중 (3/5)          │
│  BDC 연동 설정            ○ 준비 중 (1/5)          │
│                                                     │
│  ┌─ ⚠ 조치 필요 ─────────────────────────────────┐ │
│  │                                                │ │
│  │  db-analytics                                  │ │
│  │  네트워크 설정이 필요합니다                     │ │
│  │                                                │ │
│  │  VPC: my-vpc  리전: asia-northeast3            │ │
│  │  [네트워크 자동 설정]  가이드 보기 →            │ │
│  │                                                │ │
│  └────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

**── 5. 조치 필요 (PSC 승인) ──**

```
┌─────────────────────────────────────────────────────┐
│  ◐ GCP 에이전트 설치 중... (2/5 완료)            🔄│
│  ████████████████░░░░░░░░░░░░░░░░░░░░░░  40%       │
│                                                     │
│  서비스 환경 구성          ◐ 진행 중 (4/5)          │
│  BDC 연동 설정            ○ 준비 중 (2/5)          │
│                                                     │
│  ┌─ ⚠ 조치 필요 ─────────────────────────────────┐ │
│  │                                                │ │
│  │  db-psc-instance                               │ │
│  │  연결 승인이 필요합니다                         │ │
│  │                                                │ │
│  │  연결 상태: 승인 대기 중                        │ │
│  │  [승인 방법 보기]  GCP Console에서 확인 →       │ │
│  │                                                │ │
│  └────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

**── 6. 일부 실패 ──**

```
┌─────────────────────────────────────────────────────┐
│  ✕ GCP 에이전트 설치 중 오류 발생                 🔄│
│    (3/5 완료, 1건 실패)                             │
│  ████████████████████████░░░░░░░░░░░░░░  60%       │
│                                                     │
│  서비스 환경 구성          ✕ 일부 실패 (4/5, 1건)   │
│  BDC 연동 설정            ◐ 진행 중 (3/5)          │
│                                                     │
│  ┌─ ✕ 설치 오류 ─────────────────────────────────┐ │
│  │                                                │ │
│  │  db-instance-03                                │ │
│  │  설치 중 오류가 발생했습니다                    │ │
│  │  자동 복구를 시도합니다.                        │ │
│  │  지속되면 관리자에게 문의하세요.                │ │
│  │                                                │ │
│  └────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

**── 7. 복합 상황 (조치 + 실패 동시) ──**

```
┌─────────────────────────────────────────────────────┐
│  ✕ GCP 에이전트 설치 중 오류 발생                 🔄│
│    (1/5 완료, 1건 실패)                             │
│  ████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  20%       │
│                                                     │
│  서비스 환경 구성          ✕ 일부 실패 (3/5, 1건)   │
│  BDC 연동 설정            ○ 준비 중 (1/5)          │
│                                                     │
│  ┌─ ✕ 설치 오류 ─────────────────────────────────┐ │
│  │  db-instance-03 — 설치 중 오류가 발생했습니다  │ │
│  │  자동 복구를 시도합니다.                        │ │
│  └────────────────────────────────────────────────┘ │
│                                                     │
│  ┌─ ⚠ 조치 필요 ─────────────────────────────────┐ │
│  │  db-analytics — 네트워크 설정이 필요합니다      │ │
│  │  [네트워크 자동 설정]  가이드 보기 →            │ │
│  └────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

**── 8. 전체 완료 ──**

```
┌─────────────────────────────────────────────────────┐
│  ● GCP 에이전트 설치 완료 (5/5)                     │
│  ██████████████████████████████████████  100%        │
│                                                     │
│  서비스 환경 구성          ● 완료 (5/5)             │
│  BDC 연동 설정            ● 완료 (5/5)             │
└─────────────────────────────────────────────────────┘
```

#### 특징

- **D의 간결함** — 리소스를 개별 나열하지 않음. 진행률 + 그룹 요약 2줄
- **진행 상황 가시성** — "서비스 환경 구성 진행 중 (2/5)" → 무엇이 진행되고 있는지 명확
- **조치 중심 유지** — 조치/실패 카드는 D와 동일하게 필요할 때만 표시
- **안심 문구** — 조치 없을 때 "자동으로 설치가 진행 중입니다" 표시
- **그룹 순서가 실제 설치 순서와 일치** — 서비스 환경 → BDC 연동 순서로 진행

#### 장점
- 서비스 담당자가 "어느 단계가 진행 중인지" 한눈에 파악 가능
- 리소스 개별 나열 없이도 충분한 상황 인지
- 리소스 수가 늘어나도 UI 크기 변하지 않음 (D의 확장성)
- 실패/조치 시 구체적 리소스명과 안내 제공

#### 단점
- 개별 리소스 상태는 여전히 볼 수 없음 (필요 시 별도 관리 화면 필요)

---

## 4. 대안 비교

| 항목 | A. 상태 뱃지 | B. 요약+조치 | C. 2단 구조 | D. 최소 UI |
|------|:-----------:|:-----------:|:-----------:|:---------:|
| **정보량** | 많음 | 적음 | 조절 가능 | 최소 |
| **일반 사용자 친화** | 보통 | 좋음 | 좋음 | 매우 좋음 |
| **관리자 친화** | 좋음 | 부족 | 좋음 | 부족 |
| **"내가 뭘 해야 하지?"** | 보통 | 즉답 | 즉답 | 즉답 |
| **리소스별 상태 확인** | 가능 | 불가 | 펼쳐서 가능 | 불가 |
| **구현 복잡도** | 낮음 | 보통 | 보통 | 낮음 |
| **확장성 (리소스 증가)** | 페이징 필요 | 영향 없음 | 펼침 시 길어짐 | 영향 없음 |

---

## 5. 공통 변경사항 (어떤 대안이든 적용)

### 5-1. 용어 변환 테이블

| 현재 (내부 용어) | → 변경 (사용자 용어) |
|-----------------|---------------------|
| Service TF | (제거 — 통합 상태로 대체) |
| BDC TF | (제거 — 통합 상태로 대체) |
| TF 설치 대기 | 설치 준비 중 |
| TF 설치 중 | 설치 진행 중 |
| TF 설치 완료 | 설치 완료 |
| TF 설치 실패 | 설치 실패 |
| Regional Managed Proxy Subnet 필요 | 네트워크 설정이 필요합니다 |
| Regional Managed Proxy Subnet 확인됨 | 네트워크 설정 완료 |
| Subnet 자동 생성 | 네트워크 자동 설정 |
| PSC Connection 승인 대기 | 연결 승인이 필요합니다 |
| PSC Connection 거부 | 연결이 거부되었습니다 |
| `bigquery://asia-northeast3/...` | `sales_data` (인스턴스명만) |

### 5-2. 통합 상태 뱃지 스타일

| 상태 | 아이콘 | 색상 토큰 | 라벨 |
|------|--------|----------|------|
| 완료 | ● (solid circle) | `statusColors.success` | 설치 완료 |
| 진행 중 | ◐ (half circle) | `statusColors.warning` | 설치 진행 중 |
| 준비 중 | ○ (empty circle) | `statusColors.pending` | 설치 준비 중 |
| 실패 | ✕ (cross) | `statusColors.error` | 설치 실패 |
| 조치 필요 | ⚠ (warning) | `statusColors.warning` | 조치 필요 |

### 5-3. 리소스 이름 표시 규칙

```
현재:  bigquery://asia-northeast3/search-log-86753/sales_data
변경:  sales_data (BigQuery)

현재:  cloudsql://my-project/asia-northeast3/db-instance-01
변경:  db-instance-01 (Cloud SQL)
```

파싱 로직: URI의 마지막 세그먼트를 인스턴스명으로 사용

---

## 6. 수정 대상 파일

| 파일 | 변경 내용 |
|------|----------|
| `lib/constants/gcp.ts` | `GCP_TF_STATUS_LABELS` → 사용자 라벨로 변경, 통합 상태 매핑 추가 |
| `gcp/GcpInstallationInline.tsx` | 전체 레이아웃 리디자인 (선택된 대안에 따라) |
| `gcp/RegionalManagedProxyPanel.tsx` | 용어 변환 적용 ("네트워크 설정") |
| `gcp/PscApprovalGuide.tsx` | 용어 변환 적용 ("연결 승인") |
| `lib/types/gcp.ts` | 통합 상태 타입 추가 (optional) |

---

## 7. 결정 필요

**어떤 대안을 선택할지 결정이 필요합니다.**

- **A** — 리소스 목록이 중요한 관리자 중심 화면이라면
- **B** — 일반 사용자 중심이고 관리자 기능은 별도 화면에 있다면
- **C** — 일반 사용자와 관리자 모두 같은 화면을 사용한다면 (권장)
- **D** — 설치 상태가 부차적인 정보이고, 다른 곳에 상세 화면이 있다면
