# AWS 설치 모드 UI 기획

> 자동/수동 설치 모드를 사용자가 프로세스 전반에서 인지할 수 있도록 하는 UI 설계

---

## 1. 핵심 요구사항

| 요구사항 | 설명 |
|----------|------|
| 설치 모드 표시 | 프로젝트 상세 페이지에서 자동/수동 설치 모드 항상 표시 |
| 변경 불가 명시 | 설치 모드는 프로젝트 생성 시 결정되며 변경 불가함을 인지 |
| TF Role 경고 | 자동 설치 선택 시 TF Role 미등록이면 모든 단계에서 경고 |

---

## 2. 설치 모드 뱃지

### 2.1 위치
- `ProjectInfoCard` 내부 (프로젝트 기본 정보 영역)
- Cloud Provider 정보 아래 또는 옆에 배치

### 2.2 디자인

```
┌─────────────────────────────────────┐
│ 프로젝트 정보                         │
├─────────────────────────────────────┤
│ 서비스 코드    SERVICE-A              │
│ 프로젝트 코드   AWS-001               │
│ Cloud Provider  AWS                  │
│ 설치 모드      [🔄 자동 설치]  🔒     │ ← 뱃지 + 잠금 아이콘
│                                      │
│ 생성일         2026-01-15            │
└─────────────────────────────────────┘
```

### 2.3 뱃지 스타일

| 모드 | 아이콘 | 텍스트 | 색상 | Tailwind |
|------|--------|--------|------|----------|
| 자동 설치 | 🔄 또는 ⚡ | 자동 설치 | blue | `bg-blue-100 text-blue-700` |
| 수동 설치 | 📋 또는 ✋ | 수동 설치 | gray | `bg-gray-100 text-gray-700` |

### 2.4 잠금 아이콘 (변경 불가 표시)
- 뱃지 옆에 🔒 아이콘 표시
- Tooltip: "설치 모드는 프로젝트 생성 시 결정되며 변경할 수 없습니다"

---

## 3. TF Role 미등록 경고 배너

### 3.1 조건
- 설치 모드가 "자동 설치"이고
- TerraformExecutionRole이 미등록인 경우

### 3.2 표시 위치
- 프로젝트 상세 페이지 상단 (헤더 아래)
- **모든 프로세스 단계에서 표시**

### 3.3 디자인

```
┌──────────────────────────────────────────────────────────────────────┐
│ ⚠️ TerraformExecutionRole이 등록되지 않았습니다.                       │
│    자동 설치를 진행하려면 Role을 등록하세요.        [Role 등록 가이드]   │
└──────────────────────────────────────────────────────────────────────┘
```

### 3.4 스타일
```
배경: bg-amber-50
테두리: border border-amber-200
아이콘: text-amber-500
텍스트: text-amber-800
버튼: text-amber-700 hover:text-amber-900 underline
```

### 3.5 버튼 동작
- "Role 등록 가이드" 클릭 시 모달 또는 외부 문서 링크

---

## 4. ProcessStatusCard 내 설치 모드 표시

### 4.1 위치
- INSTALLING 단계 UI 내부
- 기존 `AwsInstallationInline` 컴포넌트 상단

### 4.2 디자인 (자동 설치)

```
┌──────────────────────────────────────────────────┐
│ AWS 설치 상태                    1/2  [새로고침]   │
├──────────────────────────────────────────────────┤
│ 🔄 자동 설치 모드                                 │ ← 추가
│ 시스템이 자동으로 Terraform을 실행합니다.          │
├──────────────────────────────────────────────────┤
│ ● Service TF    [완료] ✓                         │
│ ○ BDC TF        [진행 중] ◌                      │
└──────────────────────────────────────────────────┘
```

### 4.3 디자인 (수동 설치)

```
┌──────────────────────────────────────────────────┐
│ AWS 설치 상태                    0/2  [새로고침]   │
├──────────────────────────────────────────────────┤
│ 📋 수동 설치 모드                                 │ ← 추가
│ TF Script를 다운로드하여 직접 실행해주세요.         │
├──────────────────────────────────────────────────┤
│ ○ Service TF    [대기 중]                        │
│ ○ BDC TF        [대기 중]                        │
├──────────────────────────────────────────────────┤
│ ┌────────────────────────────────────────────┐   │
│ │ TF Script를 다운로드 받아서                  │   │
│ │ 담당자와 함께 설치 일정을 조율하세요.          │   │
│ │                                            │   │
│ │ [TF Script 다운로드]                        │   │
│ └────────────────────────────────────────────┘   │
└──────────────────────────────────────────────────┘
```

---

## 5. 프로세스 단계별 표시 정리

| 단계 | 설치 모드 뱃지 | TF Role 경고 | 설치 모드 안내 |
|------|---------------|-------------|---------------|
| 1. 연동 대상 확정 | ✅ ProjectInfoCard | ✅ (자동 + 미등록 시) | - |
| 2. 승인 대기 | ✅ ProjectInfoCard | ✅ (자동 + 미등록 시) | - |
| 3. 설치 진행 | ✅ ProjectInfoCard | ✅ (자동 + 미등록 시) | ✅ AwsInstallationInline |
| 4. 연결 테스트 | ✅ ProjectInfoCard | ✅ (자동 + 미등록 시) | - |
| 5. 완료 | ✅ ProjectInfoCard | - | - |

---

## 6. 데이터 요구사항

### 6.1 Project 모델 확장

```typescript
interface Project {
  // 기존 필드...

  // AWS 설치 모드 (AWS만 해당)
  awsInstallationMode?: 'AUTO' | 'MANUAL';
}
```

### 6.2 TF Role 상태 API

```typescript
// GET /api/aws/projects/{projectId}/tf-role-status
interface TfRoleStatus {
  registered: boolean;
  roleArn?: string;
  lastVerifiedAt?: string;
}
```

또는 기존 `AwsInstallationStatus`에 포함:

```typescript
interface AwsInstallationStatus {
  provider: 'AWS';
  hasTfPermission: boolean;      // 설치 모드 (true=자동, false=수동)
  tfRoleRegistered: boolean;     // TF Role 등록 여부 (추가)
  serviceTfCompleted: boolean;
  bdcTfCompleted: boolean;
  // ...
}
```

---

## 7. 컴포넌트 구조

```
AwsProjectPage
├── TfRoleWarningBanner (조건부: 자동 설치 + TF Role 미등록)
├── ProjectInfoCard
│   └── InstallationModeBadge (AWS만)
├── ProcessStatusCard
│   └── AwsInstallationInline
│       └── InstallationModeInfo (설치 모드 안내)
└── ResourceTable
```

### 7.1 신규 컴포넌트

| 컴포넌트 | 위치 | 설명 |
|----------|------|------|
| `InstallationModeBadge` | `components/ui/` | 자동/수동 설치 뱃지 |
| `TfRoleWarningBanner` | `components/features/` | TF Role 미등록 경고 배너 |

---

## 8. 구현 우선순위

### Phase 1 (필수)
1. `InstallationModeBadge` 컴포넌트 생성
2. `ProjectInfoCard`에 설치 모드 뱃지 추가
3. `AwsInstallationInline`에 설치 모드 안내 추가

### Phase 2 (필수)
4. `TfRoleWarningBanner` 컴포넌트 생성
5. `AwsProjectPage`에 경고 배너 추가
6. TF Role 상태 API 연동 (또는 기존 API 확장)

### Phase 3 (선택)
7. 프로젝트 생성 시 설치 모드 선택 UI
8. Tooltip 및 가이드 모달

---

---

## 9. Step 0: 설치 모드 선택 UI 기획

> 프로세스 시작 전, 사용자가 자동/수동 설치 모드를 선택하는 단계

### 9.1 진입 조건
- AWS 프로젝트 신규 생성 시
- 아직 설치 모드가 선택되지 않은 상태

### 9.2 UI 디자인

```
┌──────────────────────────────────────────────────────────────────────┐
│                        설치 모드 선택                                  │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  AWS PII Agent 설치 방식을 선택해주세요.                               │
│  ⚠️ 설치 모드는 프로젝트 생성 후 변경할 수 없습니다.                     │
│                                                                      │
│  ┌─────────────────────────────┐  ┌─────────────────────────────┐   │
│  │ ⚡ 자동 설치                  │  │ 📋 수동 설치                  │   │
│  │                             │  │                             │   │
│  │ • TerraformExecutionRole    │  │ • TF Script를 직접 실행      │   │
│  │   등록 필요                   │  │ • TF Role 불필요             │   │
│  │ • 시스템이 자동으로           │  │ • 담당자와 일정 조율 필요      │   │
│  │   TF 실행                    │  │                             │   │
│  │                             │  │                             │   │
│  │ [Role 등록 가이드]            │  │ [Script 설치 가이드]          │   │
│  │                             │  │                             │   │
│  │     [자동 설치 선택]          │  │     [수동 설치 선택]          │   │
│  └─────────────────────────────┘  └─────────────────────────────┘   │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

### 9.3 버튼 동작

| 버튼 | 동작 |
|------|------|
| Role 등록 가이드 | TF Role 등록 가이드 모달 열기 |
| Script 설치 가이드 | TF Script 설치 가이드 모달 열기 |
| 자동 설치 선택 | 자동 설치 모드로 프로세스 시작 |
| 수동 설치 선택 | 수동 설치 모드로 프로세스 시작 |

### 9.4 선택 후 동작
- 설치 모드가 Project에 저장됨 (`awsInstallationMode: 'AUTO' | 'MANUAL'`)
- 스캔 단계로 자동 진행

---

## 10. TF Role 등록 가이드 모달

### 10.1 트리거
- Step 0에서 "Role 등록 가이드" 버튼 클릭
- TF Role 미등록 경고 배너에서 "Role 등록 가이드" 버튼 클릭

### 10.2 모달 디자인

```
┌──────────────────────────────────────────────────────────────────────┐
│ TerraformExecutionRole 등록 가이드                           [X 닫기] │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│ 자동 설치를 위해 AWS 계정에 TerraformExecutionRole을 등록해야 합니다.   │
│                                                                      │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                                                      │
│ **Step 1. AWS Console 접속**                                         │
│ AWS Management Console > IAM > Roles로 이동합니다.                    │
│                                                                      │
│ **Step 2. Role 생성**                                                │
│ "Create Role" 버튼을 클릭하고 다음 설정을 적용합니다:                    │
│ - Trusted entity type: AWS account                                  │
│ - Account ID: [ACCOUNT_ID]                                          │
│ - Role name: TerraformExecutionRole                                 │
│                                                                      │
│ **Step 3. Policy 연결**                                              │
│ 다음 정책을 연결합니다:                                                │
│ ┌────────────────────────────────────────────────────────────────┐  │
│ │ {                                                              │  │
│ │   "Version": "2012-10-17",                                     │  │
│ │   "Statement": [...]                                           │  │
│ │ }                                          [📋 복사]            │  │
│ └────────────────────────────────────────────────────────────────┘  │
│                                                                      │
│ **Step 4. Role 등록 확인**                                           │
│ Role 생성 완료 후 아래 버튼을 클릭하여 등록 상태를 확인하세요.            │
│                                                                      │
│                              [Role 등록 확인]                         │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

### 10.3 API 연동

| API | 설명 |
|-----|------|
| `GET /api/aws/projects/{projectId}/tf-role-guide` | 가이드 내용 조회 (Account ID, Policy JSON 등) |
| `POST /api/aws/projects/{projectId}/tf-role-verify` | Role 등록 검증 |

---

## 11. TF Script 설치 가이드 모달

### 11.1 트리거
- Step 0에서 "Script 설치 가이드" 버튼 클릭
- 수동 설치 모드에서 "TF Script 다운로드" 영역의 가이드 링크

### 11.2 모달 디자인

```
┌──────────────────────────────────────────────────────────────────────┐
│ TF Script 수동 설치 가이드                                   [X 닫기] │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│ 수동 설치 모드에서는 TF Script를 직접 실행해야 합니다.                   │
│                                                                      │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                                                      │
│ **Step 1. TF Script 다운로드**                                       │
│ 승인 완료 후 INSTALLING 단계에서 TF Script를 다운로드합니다.            │
│                                                                      │
│ **Step 2. Terraform 환경 준비**                                      │
│ Terraform CLI가 설치된 환경에서 다운로드한 파일의 압축을 해제합니다.      │
│ - 필요 버전: Terraform >= 1.5.0                                      │
│ - AWS CLI 인증 필요                                                  │
│                                                                      │
│ **Step 3. Terraform 실행**                                          │
│ 다음 명령어를 순서대로 실행합니다:                                      │
│ ┌────────────────────────────────────────────────────────────────┐  │
│ │ cd terraform-script/                                           │  │
│ │ terraform init                                                 │  │
│ │ terraform plan                                                 │  │
│ │ terraform apply                                [📋 복사]        │  │
│ └────────────────────────────────────────────────────────────────┘  │
│                                                                      │
│ **Step 4. 설치 완료 확인**                                           │
│ Terraform apply 완료 후, 시스템에서 자동으로 설치 상태를 확인합니다.      │
│ 설치가 반영되기까지 최대 5분이 소요될 수 있습니다.                        │
│                                                                      │
│                                [닫기]                                │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

### 11.3 API 연동

| API | 설명 |
|-----|------|
| `GET /api/aws/projects/{projectId}/tf-script-guide` | 가이드 내용 조회 |

---

## 12. ProjectInfoCard TF Role 상태 표시

### 12.1 조건
- AWS 프로젝트이고
- 자동 설치 모드인 경우에만 표시

### 12.2 디자인

```
┌─────────────────────────────────────┐
│ 프로젝트 정보                         │
├─────────────────────────────────────┤
│ 서비스 코드    SERVICE-A              │
│ 프로젝트 코드   AWS-001               │
│ Cloud Provider  AWS                  │
│ 설치 모드      [⚡ 자동 설치]  🔒     │
│ TF Role       [✓ 등록됨]             │ ← 추가
│                                      │
│ 생성일         2026-01-15            │
└─────────────────────────────────────┘
```

### 12.3 TF Role 상태 표시

| 상태 | 표시 | 색상 |
|------|------|------|
| 등록됨 | ✓ 등록됨 | `text-green-600` |
| 미등록 | ✗ 미등록 | `text-red-600` |

### 12.4 미등록 시 추가 동작
- TF Role 상태 클릭 시 "Role 등록 가이드" 모달 열기
- 또는 상단 경고 배너로 유도

---

## 변경 이력

| 날짜 | 내용 |
|------|------|
| 2026-02-03 | Step 0 설치 모드 선택 UI, TF Role/Script 가이드 모달, ProjectInfoCard TF Role 표시 추가 |
| 2026-02-02 | 초안 작성 |
